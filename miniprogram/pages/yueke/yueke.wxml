<view class="container">
  <!-- 课程类型选择：整行平分 -->
  <view class="type-bar">
    <view class="type-btn {{selectedType=='group'?'active':''}}" data-type="group" bindtap="switchType">团课</view>
    <view class="type-btn {{selectedType=='private'?'active':''}}" data-type="private" bindtap="switchType">私教</view>
  </view>

  <!-- 本周/下周：整行平分 -->
  <view class="week-switch-bar">
    <view class="week-btn {{weekOffset==0?'active':''}}" data-offset="0" bindtap="showThisWeek">本周课表</view>
    <view class="week-btn {{weekOffset==7?'active':''}}" data-offset="7" bindtap="showNextWeek">下周课表</view>
  </view>

  <!-- 卡片选择器 -->
  <picker mode="selector" range="{{userCards}}" range-key="label" value="{{cardLabelIndex}}" bindchange="onCardChange">
    <view class="card-picker-row">
      <text>当前选择卡：</text>
      <text class="card-label">{{userCards.length>0 ? userCards[cardLabelIndex].label : '无卡'}}</text>
    </view>
  </picker>

  <!-- 日期滑动：从周一开始 -->
  <scroll-view
    scroll-x
    class="date-bar"
    enable-flex
    scroll-with-animation
    scroll-into-view="{{'d_' + selectedDate}}"
  >
    <block wx:for="{{weekDates}}" wx:key="date">
      <view
        id="d_{{item.date}}"
        class="date-btn {{selectedDate==item.date?'active':''}}"
        data-date="{{item.date}}"
        bindtap="selectDate"
      >
        <text class="date-label">{{item.day}} {{item.week}}</text>

      </view>
    </block>
  </scroll-view>

  <!-- 课程列表 -->
  <!-- 在yueke.wxml中，确保使用正确的数据字段 -->
<view class="lesson-list">
  <block wx:for="{{lessons}}" wx:key="_id" wx:for-item="item" wx:for-index="index">
    <view class="lesson-card" style="padding: 1rem;">
      <view class="lesson-time-and-status" style="display:flex; flex-direction:row; margin-right: 5%; align-items: center;">
        <view class="lesson-time" style="flex: 1; font-size: large;">
          {{item.startTime}} - {{item.endTime}}
        </view>
        <view class="lesson-status" style="flex: 1; display: contents;" wx:if="{{item.hasBooked}}">
          <radio value="{{radioValue}}" checked="true" />已预约
        </view>
      </view>
      <view class="lesson-info"><text class="lesson-label">老师：</text>{{item.teacher || '待定'}}</view>
      <view class="lesson-info"><text class="lesson-label">内容：</text>{{item.content || '-'}}</view>
      <view class="lesson-info"><text class="lesson-label">人数：</text>{{item.bookedCount}}/{{item.maxCount}}</view>
      <view class="btn-bar">
        <!-- 预约按钮 -->
        <button class="book-btn" size="mini" data-index="{{index}}" bindtap="bookLesson" wx:if="{{item.canBook}}">预约</button>

        <!-- 取消预约按钮 -->
        <button class="cancel-btn" size="mini" data-index="{{index}}" bindtap="cancelLesson" wx:if="{{item.canCancel}}">取消预约</button>
        <button class="book-btn full" size="mini" disabled wx:if="{{!item.canBook && !item.canCancel}}">
          {{item.bookTimeTip || '已约满'}}
        </button>
      </view>
    </view>
  </block>
  <view wx:if="{{lessons.length==0}}" class="empty-tip">当天暂无课程</view>
</view>
</view>